<!DOCTYPE html>
<html>
<head>
    <title>Simple Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chatbot.css') }}">
</head>
<body>
    <div class="container">
        <h1>ü§ñ AI Chatbot with Vector Knowledge</h1>
        {% if result %}
            <div class="resultado {% if not result.is_valid %}error{% endif %}">
                <h3>Result:</h3>
                <p><strong>Message:</strong> {{ result.original_message }}</p>
                <p><strong>Valid:</strong> 
                    {% if result.is_valid %}
                        <span style="color: green;">‚úÖ Yes</span>
                    {% else %}
                        <span style="color: red;">‚ùå No</span>
                    {% endif %}
                </p>
                <p><strong>Response:</strong> {{ result.response|default('') }}</p>
                {% if result.error %}
                <p style="color:darkred;"><strong>Error:</strong> {{ result.error }}</p>
                {% endif %}
                <p><strong>Intent:</strong> {{ result.intent|default('') }}</p>
                <p><strong>Prompt usado:</strong> <span style="font-size:small">{{ result.prompt_used|default('') }}</span></p>
                {% if result.context %}
                <details style="margin-top: 10px;">
                    <summary><strong>Contexto generado</strong></summary>
                    <div class="context-item">
                        <strong>Tipo de contexto:</strong> {{ result.context.context_type|default('') }}<br>
                        <strong>Instrucciones:</strong> {{ result.context.instructions|default('') }}<br>
                        {% if result.context.specific_guidance|default('') %}
                        <strong>Gu√≠a espec√≠fica:</strong> {{ result.context.specific_guidance }}<br>
                        {% endif %}
                        {% set docs = result.context.relevant_docs|default([]) %}
                        {% if docs and docs|length > 0 %}
                        <div style="margin-top:8px;">
                            <strong>Documentos relevantes:</strong>
                            <ul>
                            {% for doc in docs %}
                                <li>
                                    <strong>Fuente:</strong> {{ doc.source|default('') }} | <strong>P√°gina:</strong> {{ doc.page|default('') }}<br>
                                    <span style="font-size:small">{{ doc.content|default(doc) }}</span>
                                </li>
                            {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                        {% set examples = result.context.examples|default([]) %}
                        {% if examples and examples|length > 0 %}
                        <div style="margin-top:8px;">
                            <strong>Ejemplos relevantes:</strong>
                            <ul>
                            {% for example in examples %}
                                <li><span style="font-size:small">{{ example }}</span></li>
                            {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                </details>
                {% endif %}
            </div>
        {% endif %}
        
        {% if error %}
            <div class="resultado error">
                <p class="error-message">{{ error }}</p>
            </div>
        {% endif %}
        
        <form method="POST" action="/chat">
            <label for="message"><strong>Write your message:</strong></label>
            <input type="text" id="message" name="message" placeholder="Hello, how are you?" required>
            <button type="submit">üöÄ Send to Chatbot</button>
        </form>
        
        <div class="link">
            <a href="/">üîÑ Clear conversation</a>
        </div>
    </div>
</body>
</html>
